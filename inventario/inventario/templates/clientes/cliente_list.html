{% extends 'base.html' %}
{% load bootstrap4 %}

{% block title %}Lista de Clientes{% endblock %}
{% block header %}Lista de Clientes{% endblock %}

{% block extra_buttons %}
<div>
    <a href="{% url 'clientes:cliente_create' %}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Nuevo Cliente
    </a>
    <a href="{% url 'productos:producto_list' %}" class="btn btn-secondary">
        <i class="fas fa-box"></i> Ver Productos
    </a>
</div>
{% endblock %}

{% block content %}
<!-- Barra de búsqueda -->
<div class="row mb-3">
    <div class="col-md-6">
        <form method="get" class="form-inline">
            <div class="input-group w-100">
                <input type="text" name="search" class="form-control" placeholder="Buscar por nombre, apellido, documento o email..." value="{{ search }}">
                <div class="input-group-append">
                    <button class="btn btn-primary" type="submit">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                    {% if search %}
                    <a href="{% url 'clientes:cliente_list' %}" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Limpiar
                    </a>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>
    <div class="col-md-6 text-right">
        <p class="text-muted mt-2">
            <i class="fas fa-users"></i> Total: <strong>{{ paginator.count }}</strong> cliente{{ paginator.count|pluralize }}
        </p>
    </div>
</div>

{% if clientes %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="thead-dark">
            <tr>
                <th>Nombre Completo</th>
                <th>Documento</th>
                <th>Email</th>
                <th>Teléfono</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for cliente in clientes %}
            <tr>
                <td>
                    <i class="fas fa-user text-primary"></i>
                    <strong>{{ cliente.apellido }}, {{ cliente.nombre }}</strong>
                </td>
                <td>{{ cliente.numero_documento }}</td>
                <td>
                    <i class="fas fa-envelope text-muted"></i>
                    {{ cliente.email }}
                </td>
                <td>
                    <i class="fas fa-phone text-muted"></i>
                    {{ cliente.telefono }}
                </td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <a href="{% url 'clientes:cliente_detail' cliente.pk %}" class="btn btn-info" title="Ver detalle">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="{% url 'clientes:cliente_update' cliente.pk %}" class="btn btn-primary" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{% url 'clientes:cliente_delete' cliente.pk %}" class="btn btn-danger" title="Eliminar">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Paginación -->
{% if is_paginated %}
<nav aria-label="Paginación">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page=1{% if search %}&search={{ search }}{% endif %}">Primera</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search %}&search={{ search }}{% endif %}">Anterior</a>
            </li>
        {% endif %}

        <li class="page-item active">
            <span class="page-link">
                Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
            </span>
        </li>

        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search %}&search={{ search }}{% endif %}">Siguiente</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if search %}&search={{ search }}{% endif %}">Última</a>
            </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% else %}
<div class="alert alert-info">
    <i class="fas fa-info-circle"></i> 
    {% if search %}
        No se encontraron clientes que coincidan con "{{ search }}".
    {% else %}
        No hay clientes registrados.
    {% endif %}
</div>
{% endif %}
{% endblock %}
